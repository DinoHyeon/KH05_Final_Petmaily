<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.petmily.dao.boardDAO.BoardInter">
	<!-- 보호 게시판 리스트 -->
	<select id="protectList" parameterType="HashMap" resultType="BoardDTO">
		SELECT b.board_idx, b.board_title, p.mainPhoto FROM board
		b, photo p WHERE b.board_idx = p.board_idx AND b.board_type='보호'
	</select>

	<!-- 실종 게시판 리스트 -->
	<select id="missingList" parameterType="HashMap" resultType="BoardDTO">
		SELECT b.board_idx, b.board_title, b.board_regDate,
		p.mainPhoto FROM board b, photo p WHERE b.board_idx = p.board_idx AND
		b.board_type='실종'
	</select>

	<!-- 보호 게시판 상세보기 -->
	<select id="protectDetail" resultType="BoardDTO">
		SELECT b.board_title, b.board_content, b.board_writer, b.board_regDate,
		b.board_hit, bp.protect_loc, p.photo_newName
		FROM board b, board_protect bp, photo p
		WHERE b.board_idx=#{param1} AND bp.board_idx=#{param1} AND
		p.board_idx=#{param1}
	</select>

	<!-- 실종 게시판 상세보기 -->
	<select id="missingDetail" resultType="BoardDTO">
		SELECT b.board_title, b.board_content, b.board_writer, b.board_regDate,
		b.board_hit, bs.missing_loc, p.photo_newName
		FROM board b, board_missing bs, photo p
		WHERE b.board_idx=#{param1} AND bs.board_idx=#{param1} AND
		p.board_idx=#{param1}
	</select>

	<!-- 실종 게시판 글작성 -->
	<insert 
		id="missingWrite" 
		parameterType="BoardDTO"
		useGeneratedKeys="true" 
		keyProperty="board_idx" 
		keyColumn="board_idx">
		INSERT INTO board(board_idx, board_type, board_title, board_content, board_writer,board_hit)
		<!-- 회원 -->
		<if test="!board_writer.equals('')">
			VALUES(board_seq.NEXTVAL, '실종', #{board_title}, #{content}, loginId, 0)
		</if>
		<!-- 비회원 -->
		<if test="board_writer.equals('')">
			VALUES(board_seq.NEXTVAL, '실종', #{board_title}, #{content}, '비회원', 0)
		</if>
		
		
	<!-- 
		INSERT INTO board_missing(board_idx, missing_loc, animal_idx, animal_type,
		missing_pw)
		VALUES(board_idx, '서울 잠실', '고양이', '먼치킨', '1234') WHERE board_idx =
		board_missing.board_idx -->
	</insert>
</mapper>